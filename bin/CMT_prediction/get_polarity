#!/bin/csh
# ====================================================================
# This is a csh script to get the polarity for record
# 
# Input:	
# 	EQ_NAME
# 	EQ_lat
# 	EQ_lon
# 	EQ_dep
# 	STA_lat
# 	STA_lon
# 	PHASE
# 	COMP
# Output:
# 	a number 
#
# DATE:					Keywords:
#
# Reference:
# ===================================================================


set PWD = /mnt/data2/maligaro/EQVirSa/bin/CMT_prediction
cd $PWD
set EQ = $1
# other EQ infor is retrived through EQ_LIST in mysql
set STA_lat = $2
set STA_lon = $3
set PHASE = $4

#set EQ = 200601022213
#set STA_lat = -10
#set STA_lon = -120
#set PHASE = ScS
set name_convert = ~/bin/phase_name_convert_complex_to_simple.py 
set PHASE = `python2 $name_convert $PHASE`


set tmpfile = $PWD/.tmpfile.$$
check_event $EQ >! $tmpfile

set EQ_lat = `cat $tmpfile|grep -w EQ_LAT_ISC |awk '{print $2}' `
set EQ_lon = `cat $tmpfile|grep -w EQ_LON_ISC |awk '{print $2}' `
set EQ_dep = `cat $tmpfile|grep -w EQ_DEP_ISC |awk '{print $2}' `
set strike = `cat $tmpfile|grep -w STRIKE |awk '{print $2}' `
set dip = `cat $tmpfile|grep -w DIP |awk '{print $2}' `
set rake = `cat $tmpfile|grep -w RAKE |awk '{print $2}' `

#echo $strike $dip $rake
set CMT2RAD = $PWD/CMT2RAD
#f95 $CMT2RAD -o CMT2RAD
$CMT2RAD << EOF > & /dev/null
$strike $dip $rake
EOF


# find the component P SV SH for current phase
#if(`echo $PHASE |grep P` != "") then
	#set the_comp = P
#endif

#if(`echo $PHASE |grep S` != "") then
	#if( $COMP == T ) then
	#set the_comp = SH
	#else if($COMP == R ) then
	#set the_comp = SV
	#endif
#endif

set AZ = `python2 $PWD/compass.py $EQ_lat $EQ_lon $STA_lat $STA_lon`
set take_off = `get_taup_takeoff_2 $EQ $STA_lat $STA_lon $PHASE`

#echo $take_off
#exit 0
set the_comp = SH
set RADTHAZ = $PWD/RADTHAZ
set tmp = $PWD/.polar.tmp.$$
$RADTHAZ <<EOF >! $tmp
$strike $dip $rake
$the_comp
$take_off $AZ
EOF

set polar_pre = `awk  'NR==1 {print $1}' $tmp`
echo "$polar_pre"
	

/bin/rm $tmp
/bin/rm $tmpfile
cd -
exit 0


